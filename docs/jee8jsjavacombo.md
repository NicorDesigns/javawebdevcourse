### Combining Java and JSP in our JEE 8 Web App Module

Use these (but for JEE8) to update these code examples:

https://jakarta.ee/specifications/pages/3.0/jakarta-server-pages-spec-3.0.html#implicit-objects

We will now return to our charity registration example and start to separate our presentation logic
and business logic with Java and JSP

##### [Java combined with JSP Start Branch](https://github.com/NicorDesigns/javawebdevcourse/tree/jee8web-servlets-jsp-combo-start)

#### 1. Configuring JSP Properties in the Deployment Descriptor 

[Implicit Objects](https://jakarta.ee/specifications/pages/3.0/jakarta-server-pages-spec-3.0.html#implicit-objects)

Instead of defining the properties at the top of the JSP, we define them in the web.xml


	<jsp-config>
		 <!-- Can define one or more property group-->	
        <!-- url-pattern is used to specify where to apply the properties -->
            
        <jsp-property-group>
        	  <!-- Specifies the location of where to apply the JSP properties-->	
            <url-pattern>*.jsp</url-pattern> <!-- All jsp(f) files, all locations -->
            <url-pattern>*.jspf</url-pattern>
            
            <page-encoding>UTF-8</page-encoding>
            <scripting-invalid>false</scripting-invalid>
            <include-prelude>/WEB-INF/jsp/base.jspf</include-prelude>
            <trim-directive-whitespaces>true</trim-directive-whitespaces>
            <default-content-type>text/html</default-content-type>
        </jsp-property-group>
   </jsp-config>
   
because of this multiple property groups there are complicated rules of precedence that you will have
to follow, therefore it is much easer to stick to the "Keep it Simple Stupid" - KISS principle 

[Setting Properties for Groups of JSP Pages](https://docs.oracle.com/javaee/5/tutorial/doc/bnajg.html)


This tag is used to include the base.jspf at the beginning of each JSP file 

		   <include-prelude>/WEB-INF/jsp/base.jspf</include-prelude>
		   
to include files at the end of each JSP file in a specific property group we use

			<include-coda>         
		 
you can also use multiples of these two tags in a property group

			<page-encoding>
			<default-content-type>
			 
we are already familiar with in our implicit variable examples from our previous tutorial

			<trim-directive-whitespaces>true</trim-directive-whitespaces>
			
this removes white space generated by directives in JSP

			 <scripting-invalid>			
 
allows Embedded Java in any JSP.

The above property tags has to appear in the order and only <url-pattern> are non optional

We placed the base.jspf in the WEB-INF directory to prevent access from the web
   
      		<%@ page import="com.nicordesigns.Registration, com.nicordesigns.Attachment" %>
			<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

The index.jsp file has been updated as follows:

			<%@ page session="false" %>
			<c:redirect url="/registrations" /> 		
			
			
	 
#### 2. Forwarding a request from a Servlet to a JSP

In the Model View Controller Pattern used by combining Servlets and JSP's , the servlet acts as the
Controller that does the business logic and updates the database Model and the JSP acts as the
View Presentation that interacts with the Controller Servlet
 
#### 3. Using the Request Dispatcher 

    
	private void showRegistrationForm(HttpServletRequest request, HttpServletResponse 	response)
            throws ServletException, IOException
    {
    	
    	 request.getRequestDispatcher("/WEB-INF/jsp/view/registrationForm.jsp")
         .forward(request, response);
    }
    
now forwards to the following JSP internally without using browser http redirect to

	<%@ page session="false" %>
	<!DOCTYPE html>
	<html>
	    <head>
	        <title>Customer Support</title>
	    </head>
	    <body>
	        <h2>Create a Registration</h2>
	        <form method="POST" action="registrations" enctype="multipart/form-data">
	            <input type="hidden" name="action" value="create"/>
	            Your Name<br/>
	            <input type="text" name="customerName"><br/><br/>
	            Subject<br/>
	            <input type="text" name="subject"><br/><br/>
	            Body<br/>
	            <textarea name="body" rows="5" cols="30"></textarea><br/><br/>
	            <b>Attachments</b><br/>
	            <input type="file" name="file1"/><br/><br/>
	            <input type="submit" value="Submit"/>
	        </form>
	    </body>
	</html>
	          
#### 4. Designing for the View Layer


	<%@ page contentType="text/html;charset=UTF-8" language="java" %>
	<!DOCTYPE html>
	<html>
	    <head>
	        <title>Hello User Application</title>
	    </head>
	    <body>
	        settingOne: <%= application.getInitParameter("databaseOne") %>,
	        settingTwo: <%= application.getInitParameter("cloudOne") %>
	    </body>
	</html>

with the context init parameters


	<context-param>
        <param-name>databaseOne</param-name>
        <param-value>sql-server</param-value>
    </context-param>
    <context-param>
        <param-name>cloudOne</param-name>
        <param-value>google-cloud-platform</param-value>
    </context-param>
    
We will debug and step through this JSP logic with the help of Eclipse.
We will use the input form and the query string


#### 4. The danger of using embedded JAVA in JSP

This break the Model View Controller pattern of modern back-end Java Enterprise Applications,
and locks you into a viscous cycle of catch up with every update, bug-fix and change request of your application

This is also the reason that JSP's has been superseded by Java Server Faces in the latest JEE 8
specification on the web client tier.

There also seems to be a new flavor of the month JavaScript Framework ever so often that are used
on the web tier now that the web tier is now longer just browsers but also smart-phones and the Internet
of things






Check in the end git branch of this slide show 

##### [Embedding Java within JSP Finish Branch](https://github.com/NicorDesigns/javawebdevcourse/tree/jee8web-servlets-jsp-combo-finish)

    

